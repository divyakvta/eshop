<%- include('../partials/user/userHeader') %>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Page Title</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <style>
       

    

        .filter {
            width: 15%;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            align-self: flex-start;
            margin-right: 20px;
        }

        h5 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
        }

        .categories,
        .check,
        .sort {
            margin-bottom: 20px;
            font-size: 14px;
        }

        .form-check {
            margin-bottom: 10px;
        }

        #filter-button {
            width: 100%;
            margin-top: 20px;
        }

        .card-list {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: flex-start;
        }

        .card {
            width: 200px;
            border: 1px solid #ddd;
            border-radius: 20px;
            overflow: hidden;
            transition: transform 0.2s ease-in-out;
            background-color: #fff;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 20px 20px 0 0;
        }

        .card-body {
            padding: 15px;
        }

        .card-title {
            margin-bottom: 10px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            text-decoration: none;
        }

        .card-text {
            color: #555;
        }

        .card-price {
            color: #e44d26;
            font-size: 1.1rem;
            font-weight: bold;
        }

        a {
            text-decoration: none;
            color: inherit;
        }

        form {
            display: flex;
            justify-content: center;
            margin-bottom: 50px;
            margin-top: 20px;
            width: 600px;
            margin-left: 30%
        }

        .form-control {
            margin-right: 10px;
        }

        .btn {
            background-color: #007bff;
            color: #fff;
            border: none;
        }

        .btn:hover {
            background-color: #0056b3;
        }

        .pagination-container {
          display: flex;
          justify-content: center;
           align-items: center;
           padding-left: 100px;
          padding-right: 100px; /* Optional: Add padding for spacing */
          margin-top: 20px;
        }

        .pagination-number,
        .pagination-button{
          font-size: 1.2rem;
          background-color: #007bff;
          color: black;
          border: none;
          margin: 0.25rem;
          cursor: pointer;
          height: 2.5rem;
          width: 2.5rem;
          border-radius: .2rem;
          padding: 5px 10px;

        }

          .pagination-number:hover,
          .pagination-button:not(.disabled):hover {
          background: #e21515;
        }

    </style>
</head>

<body>
    
    <form class="form-inline">
        <input class="form-control" type="text" placeholder="Search" onkeyup="sendData(this)" aria-label="Search">
        <button class="btn" type="submit">Search</button>
    </form>

    <div class="container">
      <div class="row">
        <div class="col-md-3 filter">
            <h5>Filters</h5>
            
            <input class="form-check-input" name="cat-check" type="radio" value="all" id="all">
                <label class="form-check-label" for="flexCheckDefault">
                  All
                </label>
            
            <div class="categories">
                <h6>Categories</h6>
                <% category.forEach(cat => { %>
                    <div class="form-check">
                        <input class="form-check-input" name="cat-check" type="radio" value="<%= cat._id %>" id="category">
                        <label class="form-check-label" for="flexCheckDefault">
                            <%= cat.categoryName %>
                        </label>
                    </div>
                <% }) %>
            </div>
            <div class="check">
                <h6>Price</h6>

                  <div class="form-check">
                    <input class="form-check-input" type="radio" value="1000" name="price-range" id="">
                    <label class="form-check-label" for="flexCheckDefault">
                      below 1000 
                    </label>
                  </div> 

                  <div class="form-check">
                    <input class="form-check-input" type="radio" value="2000" name="price-range" >
                    <label class="form-check-label" for="flexCheckDefault">
                      1000 - 2000
                    </label>
                  </div> 

                  <div class="form-check">
                    <input class="form-check-input" type="radio" value="3000" name="price-range" >
                    <label class="form-check-label" for="flexCheckDefault">
                      2000 - 3000
                    </label>
                  </div> 

                  <div class="form-check">
                    <input class="form-check-input" type="radio" value="4000" name="price-range" >
                    <label class="form-check-label" for="flexCheckDefault">
                      3000 - 4000
                    </label>
                  </div> 

                  <div class="form-check">
                    <input class="form-check-input" type="radio" value="5000" name="price-range" >
                    <label class="form-check-label" for="flexCheckDefault">
                      4000 - 5000
                    </label>
                  </div> 

                  <!-- <div class="form-check">
                    <input class="form-check-input" type="radio" value="5000" name="price-range" id="flexCheckDefault">
                    <label class="form-check-label" for="flexCheckDefault">
                      5000 - 6000
                    </label>
                  </div> 
                 

                  <div class="form-check">
                    <input class="form-check-input" type="radio" value="6000" name="price-range" id="flexCheckDefault">
                    <label class="form-check-label" for="flexCheckDefault">
                      6000 - 7000
                    </label>
                  </div> 

                  
                  <div class="form-check">
                    <input class="form-check-input" type="radio" value="7000" name="price-range" id="flexCheckDefault">
                    <label class="form-check-label" for="flexCheckDefault">
                      7000 - 8000
                    </label>
                  </div> -->

                <!-- <div class="sort">
                    <h6>Sort By</h6>
                    <select class="form-select" id="sortSelect">
                        <option value="default">Default</option>
                        <option value="priceLowToHigh">Price: Low to High</option>
                        <option value="priceHighToLow">Price: High to Low</option>
                       
                    </select>
                </div> -->

                <button id="filter-button" type="button" class="btn">Filter</button>
            </div>
        </div>

        <div class="col-md-9">

  <div class="card-list" id="productList">
    <!-- Product cards go here -->
    <% product.forEach(item => { %>
      <div class="products">
        <a href="/users/product-single-view/<%= item._id %>" style="position: relative; display: block;">
          <div class="card"> 
            <img src="/uploads/<%= item.images[0].url %>" alt="" style="width: 100%; height: 200px; object-fit: cover; border-radius: 20px 20px 0 0;">
            <%= item.productOffer > 0 ? `<p class="card-header" style="position: absolute; top: 0; left: 0; background-color: #e44d26; color: #fff; padding: 5px 10px; border-radius: 20px 0 0 0;">${item.productOffer}% offer</p>` : '' %>
            <div class="card-body">
              <h5 class="card-title"><%= item.title %></h5>
              <p class="card-text" style="font-size: small;"><%= item.desc %></p>
              <p class="card-price">Rs.<%= item.price %></p>
              <a href="/users/add-to-cart/<%= item._id %>" style="text-decoration: none; color: inherit;"><button class="btn-primary">Add to cart</button></a>
            </div>
          </div>
        </a>
      </div>
    <% }); %>
    
  </div>
  </div>
  </div>
  </div>

<nav class="pagination-container">
  <button class="pagination-button" id="prev-button" title="Previous page" aria-label="Previous page">
    &lt;
  </button>
  
  <div id="pagination-numbers">
  </div>
  
  <button class="pagination-button" id="next-button" title="Next page" aria-label="Next page">
    &gt;
  </button>
</nav>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>

<script>
  $(document).ready(function () {
    let currentPage = 1;
    const pageSize = 8;

    function fetchProducts(page) {
      $.ajax({
        method: 'post',
        url: '/users/paginate',
        data: {
          page: page,
          pageSize: pageSize
        },
        success: function (res) {
          const productList = $('#productList');

          console.log(res.products)
          if (res && res.products.length > 0 ) {
            let productHTML = '';

            res.products.forEach((item) => {
              productHTML += `
  <div class="products">
    <a href="/users/product-single-view/${item._id}" style="position: relative; display: block;">
      <div class="card"> 
        <img src="/uploads/${item.images[0].url}" alt="" style="width: 100%; height: 200px; object-fit: cover; border-radius: 20px 20px 0 0;">
        ${item.productOffer > 0 ? `<p class="card-header" style="position: absolute; top: 0; left: 0; background-color: #e44d26; color: #fff; padding: 5px 10px; border-radius: 20px 0 0 0;">${item.productOffer}% offer</p>` : ''}
        ${item.discount_percentage > 0 ? `<p class="card-header" style="position: absolute; top: 0; left: 0; background-color: #e44d26; color: #fff; padding: 5px 10px; border-radius: 20px 0 0 0;">${item.discount_percentage}% offer</p>` : ''}
        <div class="card-body">
          <h5 class="card-title">${item.title}</h5>
          <p class="card-text " style="font-size: small">${item.desc}</p>
          <p class="card-price">Rs.${item.price}</p>
          <a href="/users/add-to-cart1/${item._id}" style="text-decoration: none; color: inherit;"><button class="btn-primary">Add to cart</button></a>
        </div>
      </div>
    </a>
  </div>
`;
            });

            productList.html(productHTML);
          }
        },
        error: function (error) {
          console.log(error);
        }
      });
    }

    fetchProducts(currentPage);

    $('#prev-button').on('click', function () {
      if (currentPage > 1) {
        currentPage--;
        fetchProducts(currentPage);
      }
    });

    $('#next-button').on('click', function () {
      currentPage++;
      fetchProducts(currentPage);
    });
  });
</script>
    
    <script>
        $(document).ready(function () {
            $('#filter-button').on('click', function () {
                const category = $('input[type=radio][name=cat-check]:checked').val();
                const price = $('input[type=radio][name=price-range]:checked').val();
                const sort = $('#sortSelect').val();

                console.log(category)
                $.ajax({
                    method: 'post',
                    url: '/users/product-filter',
                    data: {
                        category: category,
                        price: price,
                        sort:sort,
                    },
                    success: function (res) {
                        const productList = document.getElementById('productList');
                        console.log(res.products);

                        if (res && res.products.length > 0) {
                            let productHTML = '';

                            res.products.forEach((item) => {
                                productHTML += `
                                    <div class="products">
                                        <a href="/users/product-single-view/${item._id}">
                                            <div class="card">
                                                <img src="/uploads/${item.images[0].url}" alt="">
                                                <div class="card-body">
                                                    <h5 class="card-title">${item.title}</h5>
                                                    <p class="card-text">${item.desc}</p>
                                                    <p class="card-price">Rs.${item.price}</p>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                `;
                            });

                            productList.innerHTML = productHTML;
                        }
                    },
                    error: function (error) {
                        console.log(error);
                    }
                });
            });
        });
    </script>

<script>
    function sendData(e) {
        const productList = document.getElementById('productList');

        let match = e.value.match(/^[a-zA-Z]*/);
        let match2 = e.value.match(/\s*/);

        fetch('/users/product-search', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ search: e.value })
        })
        .then(res => res.json())
        .then(data => {
            let search = data.search;

            console.log(search);

            productList.innerHTML = '<hr>';

            search.forEach((item, index) => {
                if (index > 0) productList.innerHTML += '<hr>';
                productList.innerHTML += `
                    <div class="products">
                        <a href="/users/product-single-view/${item._id}">
                            <div class="card">
                                <img src="/uploads/${item.images[0].url}" alt="${item.name}">
                                <div class="card-body">
                                    <h5 class="card-title">${item.title}</h5>
                                    <p class="card-text">${item.desc}</p>
                                    <p class="card-price">Rs.${item.price.toFixed(2)}</p>
                                </div>
                            </div>
                        </a>
                    </div>
                `;
            });
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });
    }
</script>


<%- include('../partials/user/userFooter') %>
